FROM node:{{nodeVersion}}-alpine # Install health check dependencies RUN apk add
--no-cache wget curl WORKDIR /app # Install dependencies first (better layer
caching) COPY package*.json ./

{{#if useYarn}}
  RUN yarn install --production
{{else if usePnpm}}
  RUN npm install -g pnpm && pnpm install --prod
{{else}}
  RUN npm ci --only=production
{{/if}}

# Copy application code COPY . .

{{#if buildCommand}}
  RUN
  {{{buildCommand}}}
{{/if}}

# Set up health check endpoint RUN echo "const http=require('http');const
server=http.createServer((req,res)=>{if(req.url==='/health'){res.writeHead(200);res.end('OK');}});server.listen({{port}});"
> healthcheck.js # Add dotenv loading script RUN echo
"require('dotenv').config(); require('./healthcheck');" > load-env.js EXPOSE
{{port}}

{{#if startCommand}}
  CMD ["sh", "-c", "{{{startCommand}}}"]
{{else}}
  CMD ["sh", "-c", "node load-env.js & npm start"]
{{/if}}